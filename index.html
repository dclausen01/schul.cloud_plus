<!doctype html>
<html lang="en">
 <head> 
    <meta charset="UTF-8" />
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="msapplication-starturl" content="/">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="manifest" href="manifest.json">
    <title>BBZ Cloud</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="text/javascript" src="helper.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.4/jquery-confirm.min.js"></script>
    <link rel="icon" type="image/x-icon" href="icon.ico">
    <style>
     /* Additional styles if needed */
        body {
            overflow: hidden;
        }
    </style>
 </head>
 <body class="bg-gray-100 dark:bg-gray-900 max-w-full">
    <div class="mx-auto p-2">
     <!-- Header with Logo and Buttons -->
        <div id="navbar" class="flex items-center justify-between h-16 bg-white dark:bg-gray-900 p-2 shadow-md">
            <a href="https://www.bbz-rd-eck.de" target="_blank">
                <img src="BBZ-Logo-Master.png" alt="BBZ Logo" class="dark:hidden mr-4 max-sm:w-8 w-16" />
                <img src="BBZ-Logo-Master-dark.png" alt="BBZ Logo" class="hidden dark:flex mr-4 max-sm:w-8 w-16" />
            </a>
            <h1
                class="mb-4 mr-2 mt-2 max-sm:hidden text-center font-bold leading-none tracking-tight text-gray-900 md:text-4xl dark:text-white">
                BBZ Cloud
            </h1>
            <div class="inline-flex">
                <button
            id="schulCloudBtn"
            class="bg-yellow-500 hover:bg-yellow-600 text-white font-semibold xs:text-xs sm:text-sm md:text-md lg:text-lg py-2 px-4 rounded-l"
                >
                    schul cloud
                </button>
                <button
                    id="moodleBtn"
                    class="bg-orange-500 hover:bg-orange-700 text-white font-semibold xs:text-xs sm:text-sm md:text-md lg:text-lg py-2 px-4 rounded-none"
                >
                    Moodle
                </button>
                <button id="bbbBtn"
                    class="max-sm:hidden bg-blue-800 hover:bg-blue-900 text-white font-semibold xs:text-xs sm:text-sm md:text-md lg:text-lg py-2 px-4 rounded-none">
                    Big Blue Button
                </button>
                <button id="owaBtn"
                    class="max-sm:hidden bg-blue-600 hover:bg-blue-700 text-white font-semibold xs:text-xs sm:text-sm md:text-md lg:text-lg py-2 px-4 rounded-none">
                    OWA
                </button>
                <button id="untisBtn"
                    class="max-sm:hidden bg-orange-600 hover:bg-orange-700 text-white xs:text-xs sm:text-sm md:text-md lg:text-lg font-semibold py-2 px-4 rounded-none">
                    UNTIS
                </button>
                <button id="cryptPadBtn" class="bg-cyan-500 hover:bg-cyan-600 text-white xs:text-xs sm:text-sm md:text-md lg:text-lg font-semibold py-2 px-4 rounded-none">
                    Crypt Pad
                </button>
                <button
                    id="taskcardsBtn"
                    class="max-sm:hidden bg-cyan-300 hover:bg-cyan-500 text-white xs:text-xs sm:text-sm md:text-md lg:text-lg font-semibold py-2 px-4 rounded-none"
                >
                    Task Cards
                </button>
                <button id="bbzWikiBtn"
                    class="bg-blue-300 hover:bg-blue-500 text-white xs:text-xs sm:text-sm md:text-md lg:text-lg font-semibold py-2 px-4 rounded-none">
                    BBZ Wiki
                </button>
                <button id="dropdownBtn"
                    class="bg-green-300 hover:bg-green-500 text-white font-semibold xs:text-xs sm:text-sm md:text-md lg:text-lg py-2 px-4 rounded-r">
                    ↓
                </button>
                <ul id="dropdownListe" class="absolute hidden bg-white dark:bg-gray-900 text-gray-700 dark:text-gray-100 pt-1">
                    <li class="md:hidden"><a href="https://neilo.webuntis.com/WebUntis/?school=bbz-rd-eck#/basic/login" target="_blank"
                            class="block px-4 py-2 text-sm hover:bg-gray-100">
                            <img src="https://s2.googleusercontent.com/s2/favicons?domain_url=https://neilo.webuntis.com"
                                class="inline-block h-4 mr-4">
                            <b>UNTIS</b>
                        </a>
                    </li>
                    <li class="md:hidden"><a href="https://exchange.bbz-rd-eck.de/owa" target="_blank"
                            class="block px-4 py-2 text-sm hover:bg-gray-100">
                            <img src="https://s2.googleusercontent.com/s2/favicons?domain_url=https://www.outlook.com"
                                class="inline-block h-4 mr-4">
                            <b>OWA</b>
                        </a>
                    </li>
                    <li class="md:hidden"><a href="https://bbzrdeck.taskcards.app/#/home/start" target="_blank"
                            class="block px-4 py-2 text-sm hover:bg-gray-100">
                            <img src="https://s2.googleusercontent.com/s2/favicons?domain_url=https://bbzrdeck.taskcards.app/"
                                class="inline-block h-4 mr-4">
                            <b>Task Cards</b>
                        </a>
                    </li>
                    <li class="md:hidden"><a href="https://bbb.bbz-rd-eck.de/b/signin" target="_blank"
                            class="block px-4 py-2 text-sm hover:bg-gray-100">
                            <img src="https://s2.googleusercontent.com/s2/favicons?domain_url=https://bbb.bbz-rd-eck.de"
                                class="inline-block h-4 mr-4">
                            <b>Big Blue Button</b>
                        </a>
                    </li>
                    <li class="flex justify-between">
                        <a href="https://office.com" target="_blank" class="block px-4 py-2 text-sm hover:bg-gray-100">
                            <img src="https://s2.googleusercontent.com/s2/favicons?domain_url=https://www.office.com" class="inline-block h-4 mr-4">
                            <b>Office</b>
                        </a>
                    </li>
                    <li><a href="https://www.onenote.com/notebooks?auth=2&nf=1" target="_blank" class="block px-4 py-2 text-sm hover:bg-gray-100">
                            <img src="https://s2.googleusercontent.com/s2/favicons?domain_url=https://www.onenote.com"
                                class="inline-block h-4 mr-4">
                            <b>OneNote</b>
                        </a>
                    </li>
                    <li><a href="https://ladigitale.dev/digiscreen/" target="_blank" class="block px-4 py-2 text-sm hover:bg-gray-100">
                        <img src="https://s2.googleusercontent.com/s2/favicons?domain_url=https://ladigitale.dev/digiscreen/" class="inline-block h-4 mr-4">
                        <b>Digiscreen</b>
                        </a>
                    </li>
                    <li><a href="https://www.oncoo.de/" target="_blank" class="block px-4 py-2 text-sm hover:bg-gray-100">
                            <img src="https://s2.googleusercontent.com/s2/favicons?domain_url=https://www.oncoo.de/"
                                class="inline-block h-4 mr-4">
                            <b>Oncoo</b>
                        </a>
                    </li>
                    <li><a href="https://miro.com/de/" target="_blank" class="block px-4 py-2 text-sm hover:bg-gray-100">
                            <img src="https://s2.googleusercontent.com/s2/favicons?domain_url=https://miro.com/"
                                class="inline-block h-4 mr-4">
                            <b>Miro</b>
                        </a>
                    </li>
                    <li><a href="https://bibox2.westermann.de/" target="_blank" class="block px-4 py-2 text-sm hover:bg-gray-100">
                        <img src="https://s2.googleusercontent.com/s2/favicons?domain_url=https://bibox2.westermann.de/"
                            class="inline-block h-4 mr-4">
                            <b>BiBox</b>
                        </a>
                    </li>
                    <li><a href="https://bbzrdeck.librishare.de/" target="_blank" class="block px-4 py-2 text-sm hover:bg-gray-100">
                            <img src="https://s2.googleusercontent.com/s2/favicons?domain_url=https://bbzrdeck.librishare.de/"
                                class="inline-block h-4 mr-4">
                            <b>BBZ Bibliothek SozPäd</b>
                        </a>
                    </li>
                    <li><a href="https://my.plagaware.com/login" target="_blank" class="block px-4 py-2 text-sm hover:bg-gray-100">
                        <img src="https://s2.googleusercontent.com/s2/favicons?domain_url=https://my.plagaware.com/"
                            class="inline-block h-4 mr-4">
                            <b>PlagScan</b>
                        </a>
                    </li>
                    <li><a href="https://kurzelinks.de/" target="_blank" class="block px-4 py-2 text-sm hover:bg-gray-100">
                        <img src="https://s2.googleusercontent.com/s2/favicons?domain_url=https://kurzelinks.de/"
                            class="inline-block h-4 mr-4">
                            <b>Kurze Links</b>
                        </a>
                    </li>
                    <li><a href="https://portal.schule-sh.de/univention/portal/#/" target="_blank" class="block px-4 py-2 text-sm hover:bg-gray-100">
                        <img src="https://s2.googleusercontent.com/s2/favicons?domain_url=https://portal.schule-sh.de/univention" 
                            class="inline-block h-4 mr-4">
                            <b>Schule.SH</b>
                        </a>
                    </li>
                    <li><hr></li>
                    <li id="addEntryLI">
                        <button id="addEntryBtn" class="block px-4 py-2 text-center text-2xl hover:bg-blue-200">+</button>
                    </li>
                </ul>
            </div>
        </div>

    <!-- Modal -->
    <div id="modal" class="hidden fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center">
        <div class="bg-white dark:bg-gray-900 p-4 rounded">
            <h2 class="text-lg font-bold mb-2">Eintrag hinzufügen</h2>
            <input type="text" id="nameInput" placeholder="Name" class="border border-gray-300 p-2 mb-2" />
            <input type="text" id="urlInput" placeholder="URL" class="border border-gray-300 p-2 mb-2" />
            <button id="saveEntryBtn" class="bg-blue-500 text-white px-4 py-2 rounded">Speichern</button>
            <button id="cancelBtn" class="bg-gray-300 text-gray-700 px-4 py-2 rounded ml-2">Abbrechen</button>
        </div>
    </div>

   <!-- WebView Components -->
    <iframe id="webViewSC" allowtransparency="true" target="_top" src="https://app.schul.cloud" class=" hidden w-full mt-1 border-0 bg-white dark:bg-gray-800"></iframe>
    <iframe id="webViewMoodle" allowtransparency="true" src="https://portal.bbz-rd-eck.com/?" class="hidden w-full mt-1 border-0 bg-white dark:bg-gray-800"></iframe>
    <iframe id="webViewUntis" allowtransparency="true" src="https://neilo.webuntis.com/WebUntis/?school=bbz-rd-eck#/basic/login" class="hidden w-full mt-1 border-0 bg-white dark:bg-gray-800"></iframe>
    <iframe id="webViewTaskCards" allowtransparency="true" src="https://bbzrdeck.taskcards.app/#/home/start" class="hidden w-full mt-1 border-0 bg-white dark:bg-gray-800"></iframe>
    <iframe id="webViewWiki" allowtransparency="true" src="https://wiki.bbz-rd-eck.com" class="hidden w-full mt-1 border-0 bg-white dark:bg-gray-800"></iframe>
    <iframe id="webViewStart" allowtransparency="true" src="start.html" class="w-full mt-1 border-0 bg-white dark:bg-gray-800"></iframe>
</div>

<script>
    // Get all WebViews
    const webViews = document.querySelectorAll("iframe");

    // JavaScript to handle button actions and WebView interactions
    const webViewStart = document.getElementById("webViewStart");
    const webViewSC = document.getElementById("webViewSC");
    const webViewMoodle = document.getElementById("webViewMoodle");
    const webViewUntis = document.getElementById("webViewUntis");
    const webViewTaskCards = document.getElementById("webViewTaskCards");
    const webViewWiki = document.getElementById("webViewWiki");
    // Set the source of the start page
    webViewStart.src = "start.html";
    // Set the current WebView to the start page
    let currentWebView = webViewStart;
    // global variable to store reference of the window objects
    let windowObjectReference = {
        "https://exchange.bbz-rd-eck.de/owa": null,
        "https://bbb.bbz-rd-eck.de/b/signin": null,
        "https://cryptpad.fr": null
    }; 

    // Function to read entries from localStorage and append them to the list
    function appendEntriesFromLocalStorage() {
        const entries = JSON.parse(localStorage.getItem("entries"));
        const list = document.getElementById("dropdownListe");

        if (entries && Array.isArray(entries)) {
            entries.forEach((entry) => {
                const listItem = document.createElement("li");
                listItem.classList.add("flex", "justify-between");
                const link = document.createElement("a");
                // adding favicons
                const favicon = document.createElement("img");
                favicon.src = "https://s2.googleusercontent.com/s2/favicons?domain_url="+entry.url;
                favicon.classList.add("inline-block", "h-4", "mr-4");
                // adding link
                link.href = entry.url;
                link.target = "_blank";
                link.textContent = entry.name;
                link.classList.add("block", "px-4", "py-2", "text-sm", "hover:bg-gray-100");
                link.prepend(favicon);
                listItem.appendChild(link);

                const deleteButton = document.createElement("button");
                deleteButton.textContent = "-";
                deleteButton.classList.add("ml-2", "text-red-500", "hover:text-red-700", "font-bold", "text-2xl");
                deleteButton.addEventListener("click", () => {
                    const confirmDelete = confirm("Soll dieser Eintrag wirklich gelöscht werden?");
                    if (confirmDelete) {
                        listItem.remove();
                        // Code to delete the entry from localStorage
                        const entries = JSON.parse(localStorage.getItem("entries"));
                        const updatedEntries = entries.filter((entry) => entry.name !== link.textContent);
                        localStorage.setItem("entries", JSON.stringify(updatedEntries));
                        if (updatedEntries.length === 0) {
                            localStorage.removeItem("entries");
                        }
                        }
                    });
                listItem.appendChild(deleteButton);

                list.appendChild(listItem);
            });
        }
        // Move the addEntryLI element to the end of the list
        const addEntryItem = document.getElementById("addEntryLI");
        list.appendChild(addEntryItem);
    }

    // Call the function on page load
    window.addEventListener("load", appendEntriesFromLocalStorage);

    // Function to adjust the height of the WebView to the available space
    function adjustIframeHeight() {
        const navbarHeight = document.getElementById("navbar").offsetHeight;
        webViews.forEach(wv => {
            wv.style.height = `calc(100vh - ${navbarHeight + 5}px)`;
        });
    }
           
    // Call the function initially
    adjustIframeHeight();

    // Adjust iframe height when window is resized
    window.addEventListener("resize", adjustIframeHeight);

    // Function to load a URL into the WebView and update the URL field
    function loadUrl(webview) {
        if (webview.classList.contains("hidden")) {
            webview.classList.remove("hidden");
            currentWebView.classList.add("hidden");
            currentWebView = webview;
        };
    }
    
    function loadUrlNewWindow(url, type) {
        // If window already exists, then set focus to it instead of opening a new window
        const windowObject = windowObjectReference[url] || null;
        if (windowObject === null || windowObject.closed) {
            windowObjectReference[url] = window.open(url, type, 'menubar=no, status=no, width=1100, height=700, location=no, toolbar=no');
        } else {
            windowObject.focus();
        }
    } 

    // Open modal when add entry button is clicked
    const addEntryBtn = document.getElementById("addEntryBtn");
    const modal = document.getElementById("modal");
    addEntryBtn.addEventListener("click", function() {
        modal.classList.remove("hidden");
    });

    // Save entry to localStorage when save button is clicked
    const saveEntryBtn = document.getElementById("saveEntryBtn");
    const nameInput = document.getElementById("nameInput");
    const urlInput = document.getElementById("urlInput");
    saveEntryBtn.addEventListener("click", function() {
        const name = nameInput.value;
        let url = urlInput.value;
        if (name && url) {
            if (!url.startsWith("http://") && !url.startsWith("https://")) {
                url = "https://" + url;
            }
            const entry = { name, url };
            const entries = JSON.parse(localStorage.getItem("entries")) || [];
            entries.push(entry);
            localStorage.setItem("entries", JSON.stringify(entries));
            nameInput.value = "";
            urlInput.value = "";
            modal.classList.add("hidden");
        }
        appendEntriesFromLocalStorage();
    });

    // Close modal when cancel button is clicked
    const cancelBtn = document.getElementById("cancelBtn");
    cancelBtn.addEventListener("click", function() {
        nameInput.value = "";
        urlInput.value = "";
        modal.classList.add("hidden");
    });
    
    // Button event listeners
    document
        .getElementById("schulCloudBtn")
        .addEventListener("click", () => loadUrl(webViewSC));
    document
        .getElementById("moodleBtn")
        .addEventListener("click", () => loadUrl(webViewMoodle));
    document
        .getElementById("untisBtn")
        .addEventListener("click", () => loadUrl(webViewUntis));
    document
        .getElementById("owaBtn")
        .addEventListener("click", () => loadUrlNewWindow("https://exchange.bbz-rd-eck.de/owa", "_blank"));
    document
        .getElementById("bbbBtn")
        .addEventListener("click", () => loadUrlNewWindow("https://bbb.bbz-rd-eck.de/b/signin", "_blank"));
    document
    .getElementById("cryptPadBtn")
    .addEventListener("click", () => loadUrlNewWindow("https://cryptpad.fr", "_blank"));
    document
        .getElementById("taskcardsBtn")
        .addEventListener("click", () => loadUrl(webViewTaskCards));
    document
    .getElementById("bbzWikiBtn")
    .addEventListener("click", () => loadUrl(webViewWiki));
    document
        .getElementById("dropdownBtn")
        .addEventListener("click", () => {
            const dropdownList = document.getElementById("dropdownListe");
            dropdownList.classList.toggle("hidden");
            const buttonRect = document.getElementById("dropdownBtn").getBoundingClientRect();
            dropdownList.style.top = `${buttonRect.bottom}px`;
            dropdownList.style.left = `${buttonRect.left-100}px`;
        });

    window.addEventListener("resize", () => {
        const dropdownList = document.getElementById("dropdownListe");
        const buttonRect = document.getElementById("dropdownBtn").getBoundingClientRect();
        dropdownList.style.top = `${buttonRect.bottom}px`;
        dropdownList.style.left = `${buttonRect.left-100}px`;
        schulCloudWindow.moveTo(window.innerWidth - 600, window.screenY);
    });

    // Close schul.cloud window when main window is closed
    window.addEventListener("beforeunload", function () {
        schulCloudWindow.close();
    });

    // Adjust schul.cloud window position when main window is moved
    window.addEventListener("move", function () {
        schulCloudWindow.moveTo(window.innerWidth - 600, window.screenY);
    });

    // Prevent scrolling 
    window.addEventListener("scroll", (e) => {
            e.preventDefault();
            window.scrollTo(0, 0);
        });

    // Close dropdown menu when a click event occurs anywhere on the screen
    window.addEventListener("click", (event) => {
        const dropdownList = document.getElementById("dropdownListe");
        if (!event.target.matches("#dropdownBtn") && !event.target.matches("#dropdownListe")) {
            dropdownList.classList.add("hidden");
        }
    });
            
    </script>
  </body>
</html>
